# name: train-daily

# permissions:
#   contents: write

# on:
#   schedule:
#     - cron: "0 19 * * *"  # daily at 12:00 PKT
#   workflow_dispatch:

# jobs:
#   train:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4
#       - uses: actions/setup-python@v5
#         with:
#           python-version: "3.11"
#       - run: pip install -r requirements.txt
#       - run: python src/train.py
#       - uses: actions/upload-artifact@v4
#         with:
#           name: models
#           path: models/






name: train-daily

permissions:
  contents: write

on:
  schedule:
    - cron: "0 19 * * *"
  workflow_dispatch:

jobs:
  train:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install project deps
        run: pip install -r requirements.txt

      - name: Train (multi-horizon)
        run: python src/train.py

      # --- NEW: Push engineered features.parquet to Hopsworks Feature Store ---
      - name: Push features to Hopsworks
        env:
          HOPSWORKS_PROJECT: ${{ secrets.HOPSWORKS_PROJECT }}
          HOPSWORKS_API_KEY: ${{ secrets.HOPSWORKS_API_KEY }}
        run: |
          pip install "hopsworks>=3.4,<4.0"
          python src/push_features_hopsworks.py

      # --- NEW: Register 24/48/72h models in Hopsworks Model Registry ---
      - name: Register models to Hopsworks
        env:
          HOPSWORKS_PROJECT: ${{ secrets.HOPSWORKS_PROJECT }}
          HOPSWORKS_API_KEY: ${{ secrets.HOPSWORKS_API_KEY }}
        run: |
          pip install "hopsworks>=3.4,<4.0"
          python src/register_hopsworks.py

      - uses: actions/upload-artifact@v4
        with:
          name: models
          path: models/
